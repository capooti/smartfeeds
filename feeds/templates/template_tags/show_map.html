<!-- Place map -->
{% load static %}

<script  type="text/javascript" src="{% get_static_prefix %}/js/OpenLayers-2.11/lib/OpenLayers.js"></script>
<script src='http://maps.google.com/maps/api/js?v=3.3&amp;sensor=false&amp;key={{ google_api_key2 }}'></script>

<script type="text/javascript">

var map;

function wgs84ToMercator(point){
    return point.transform(
        new OpenLayers.Projection("EPSG:4326"), // transform from WGS 1984
        new OpenLayers.Projection("EPSG:900913") // to Spherical Mercator Projection
    )
}

function initMap() {

     map = new OpenLayers.Map({
        div: "map",
        projection: new OpenLayers.Projection("EPSG:900913"),
        units: "m",
        maxResolution: 156543.0339,
        maxExtent: new OpenLayers.Bounds(
            -20037508, -20037508, 20037508, 20037508.34
        )
    });
    
    // layers
    // google
    var lyr_google = new OpenLayers.Layer.Google("Google Streets");
    // OSM (mapnik)
    var lyr_osm = new OpenLayers.Layer.OSM("OpenStreetMap");
    
    // project place position
    var point = new OpenLayers.LonLat({{ place.geometry.x }}, {{place.geometry.y}});
    wgs84ToMercator(point);
    
    // place style
    var lyr_place = new OpenLayers.Layer.Vector("Place");
    var pointFeature = new OpenLayers.Feature.Vector(
        new OpenLayers.Geometry.Point(point.lon, point.lat), {}, {});
    lyr_place.addFeatures(pointFeature);
    
    map.addLayers([ lyr_google, lyr_osm, lyr_place ]);
    
    // controls
    map.addControl(new OpenLayers.Control.LayerSwitcher());
    map.addControl(new OpenLayers.Control.MousePosition());

    // set center
    map.setCenter(point, 9);

    /*
    map.setCenter(
        point.transform(
            proj4326,
            map.getProjectionObject()
        ), 9);
    */
}

</script>
<script type="text/javascript"> window.onload=initMap; </script>
<div style="width:600px; height:300px" id='map' ></div> 
